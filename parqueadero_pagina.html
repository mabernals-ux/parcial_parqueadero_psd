<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel Parqueadero</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Fuente moderna -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#00796b;
      --primary-600:#00695c;
      --accent:#00bfa5;
      --card-bg: rgba(255,255,255,0.9);
      --muted:#6b7280;
      --success:#28a745;
    }
    *{box-sizing:border-box;font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    html,body{height:100%;}
    body {
      background: linear-gradient(180deg, #f6fbfb 0%, #eef7f6 50%, #f4f6f9 100%);
      padding: 1.5rem;
      color:#1f2937;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-y: auto;
    }
    .container { max-width:1100px; }
    header { margin-bottom: 1rem; display:flex; justify-content:center; align-items:center; }
    h1.titulo-parqueadero {
      font-size: 3rem;
      font-weight: 800;
      color: #008000;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
      margin: 30px 0;
      letter-spacing: 2px;
      text-align: center;
    }
    .card {
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(11,22,25,0.06);
      margin-top: 1rem;
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.95));
      transition: transform .22s cubic-bezier(.2,.9,.2,1), box-shadow .22s;
      overflow: hidden;
    }
    .card:hover { transform: translateY(-6px); box-shadow: 0 18px 40px rgba(11,22,25,0.10); }

    .nav-pills .nav-link {
      border-radius: 999px;
      padding: .6rem 0.95rem;
      transition: all .18s;
      font-weight:600;
      color: rgba(0,0,0,0.65);
    }
    .nav-pills .nav-link.active {
      background: linear-gradient(90deg,var(--primary),var(--primary-600));
      color: #fff;
      box-shadow: 0 6px 18px rgba(0,121,106,0.16);
      transform: translateY(-2px);
    }

    #ad-banner {
      border-radius: 12px; 
      padding: 12px; 
      margin-bottom: 15px; 
      display:flex; 
      align-items:center; 
      gap:12px; 
      background: linear-gradient(90deg,#00bcd4,#00838f);
      color:white;
      box-shadow: 0 8px 30px rgba(0,131,143,0.12);
      animation: pulseGlow 3s infinite;
      overflow: hidden;
      position:relative;
    }
    #ad-banner img{ width:64px; height:64px; object-fit:cover; border-radius:10px; background:rgba(255,255,255,0.06); padding:6px; }
    #ad-close { background: rgba(255,255,255,0.14); border: none; color: white; width:36px;height:36px;border-radius:8px; transition: transform .15s, background .15s; }
    #ad-close:hover{ transform: scale(1.06); background: rgba(255,255,255,0.22); }

    #resumen-parqueadero {
      background: linear-gradient(135deg, rgba(0,150,136,0.06), rgba(0,188,212,0.03));
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 12px;
      font-weight:600;
      color: #063a35;
      display:inline-block;
      min-width:230px;
      box-shadow: 0 8px 18px rgba(7,24,18,0.04);
      transition: transform .18s;
    }
    #resumen-parqueadero span { font-weight:800; font-size:1.05rem; }

    .form-control { border-radius: 10px; border: 1px solid rgba(16,24,32,0.06); background: rgba(255,255,255,0.8); transition: box-shadow .15s, transform .12s; }
    .form-control:focus { outline: none; box-shadow: 0 6px 22px rgba(0,121,106,0.08); transform: translateY(-2px); border-color: var(--accent); }

    .btn { border-radius: 10px; padding: .5rem .9rem; font-weight:600; letter-spacing: .2px; }
    .btn-success { background: linear-gradient(90deg,#17b169,#12a05b); border: none; color:#fff; }
    .btn-primary { background: linear-gradient(90deg,var(--primary),var(--primary-600)); border: none; color: #fff; }
    .btn-warning { background: linear-gradient(90deg,#ffb020,#ff9f00); border: none; color: #1b1b1b; }
    .btn-danger { background: linear-gradient(90deg,#ff6b6b,#ff4d4d); border: none; }

    @keyframes pulseGlow {
      0% { box-shadow: 0 6px 20px rgba(0,131,143,0.08); transform: translateY(0); }
      50% { box-shadow: 0 18px 40px rgba(0,131,143,0.14); transform: translateY(-3px); }
      100% { box-shadow: 0 6px 20px rgba(0,131,143,0.08); transform: translateY(0); }
    }
  </style>
</head>

<body>
<div class="container">
  <header>
    <h1 class="titulo-parqueadero">ðŸš— SISTEMA DEL PARQUEADERO ðŸš—</h1>
  </header>

  <!-- Banner -->
  <div id="ad-banner" class="mb-3">
    <img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" alt="Ãcono parqueadero" />
    <div style="font-size:1.05rem; font-weight:700;">
      ðŸš— <span style="color:#ffe082;">SERVICIO 24 HORAS</span>
      <div style="font-size:0.86rem; font-weight:500; opacity:0.95; margin-top:4px;">AtenciÃ³n continua â€” Seguridad y control en tiempo real.</div>
    </div>
    <div class="ms-auto d-flex align-items-center gap-2">
      <button id="ad-refresh" class="btn btn-light btn-sm" style="font-weight:700;">â†»</button>
      <button id="ad-close" class="btn btn-light btn-sm">âœ–</button>
    </div>
  </div>

  <!-- Menu principal -->
  <ul class="nav nav-pills justify-content-center mb-3" id="menu" role="tablist">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#sec-usuario">Registrar Usuario</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#sec-vehiculo">Registrar VehÃ­culo</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#sec-asignar">Asignar Espacio</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#sec-salida">Registrar Salida</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#sec-estado">Estado</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#sec-listados">Listados</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#sec-recarga">Recargar</button></li>
    <li class="nav-item"><button id="btn-cambiar-rol" class="nav-link text-danger">Cambiar Rol</button></li>
  </ul>

  <div class="tab-content">
    <!-- Registrar Usuario -->
    <div class="tab-pane fade show active" id="sec-usuario">
      <div class="card">
        <div class="card-body">
          <form id="frm-usuario">
            <div class="row g-2">
              <div class="col-md-6"><label>Nombre</label><input class="form-control" name="nombre" required /></div>
              <div class="col-md-6"><label>Tipo Documento</label><input class="form-control" name="tipo_documento" required /></div>
              <div class="col-md-6"><label>NÃºmero IdentificaciÃ³n</label><input class="form-control" name="numero_identificacion" required /></div>
              <div class="col-md-6"><label>Saldo Inicial</label><input type="number" step="0.01" class="form-control" name="saldo" value="5000" required /></div>
            </div>
            <div class="mt-3">
              <button class="btn btn-success">Registrar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Registrar VehÃ­culo -->
    <!-- Registrar VehÃ­culo -->
<div class="tab-pane fade" id="sec-vehiculo">
  <div class="card">
    <div class="card-body">
      <form id="frm-vehiculo">
        <div class="row g-2">
          <div class="col-md-4">
            <label>Placa</label>
            <input class="form-control" name="placa" required />
          </div>
          <div class="col-md-4">
            <label>Tipo VehÃ­culo (1=Carro, 2=Moto)</label>
            <input type="number" class="form-control" name="tipo_vehiculo_id" value="1" required />
          </div>
          <div class="col-md-4">
            <label>NÃºmero IdentificaciÃ³n (propietario)</label>
            <input class="form-control" name="numero_identificacion" required />
          </div>
          <div class="col-md-6 mt-2">
            <label>RFID</label>
            <input class="form-control" name="uid.rfid" id="input-rfid" readonly />
          </div>
        </div>
        <div class="mt-3">
          <button class="btn btn-success">Registrar VehÃ­culo</button>
        </div>
      </form>
    </div>
  </div>
</div>

   <!-- Asignar espacio -->
      <div class="tab-pane fade" id="sec-asignar">
        <div class="card">
          <div class="card-body">
            <div class="section-title"><span class="dot"></span><h5 class="mb-0">Asignar Espacio</h5></div>
            <form id="frm-asignar">
              <div class="row g-2">
                <div class="col-md-8">
                  <label class="form-label">Placa</label>
                  <input class="form-control" name="placa" required />
                </div>
              </div>
              <div class="mt-3">
                <button class="btn btn-primary">Asignar</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Registrar salida -->
      <div class="tab-pane fade" id="sec-salida">
        <div class="card">
          <div class="card-body">
            <div class="section-title"><span class="dot"></span><h5 class="mb-0">Registrar Salida</h5></div>
            <form id="frm-salida">
              <div class="row g-2">
                <div class="col-md-8">
                  <label class="form-label">Placa</label>
                  <input class="form-control" name="placa" required />
                </div>
              </div>
              <div class="mt-3">
                <button class="btn btn-danger">Registrar Salida</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Estado del parqueadero -->
      <div class="tab-pane fade" id="sec-estado">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <div>
                <div class="section-title"><span class="dot"></span><h5 class="mb-0">Estado del Parqueadero</h5></div>
                <div id="resumen-parqueadero" class="text-start">
                  ðŸŸ¢ <span id="contador-libres" class="counter-anim">0</span> libres &nbsp; | &nbsp;
                  ðŸ”´ <span id="contador-ocupados" class="counter-anim">0</span> ocupados &nbsp; | &nbsp;
                  <span id="contador-total" class="counter-anim">0</span> total
                </div>
              </div>

              <div class="d-flex gap-2">
                <button id="btn-estado" class="btn btn-outline-primary">Mostrar Estado</button>
                <button id="btn-estado-excel" class="btn btn-outline-success">Descargar Excel</button>
              </div>
            </div>

            <div id="out-estado" class="table-responsive text-center">
              <p class="text-muted">Haz clic en "Mostrar Estado" para ver los espacios.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Recargar -->
      <div class="tab-pane fade" id="sec-recarga">
        <div class="card">
          <div class="card-body">
            <div class="section-title"><span class="dot"></span><h5 class="mb-0">Recargar Saldo</h5></div>
            <form id="frm-recarga">
              <div class="row g-2">
                <div class="col-md-6">
                  <label class="form-label">NÃºmero de IdentificaciÃ³n</label>
                  <input class="form-control" name="numero_identificacion" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Monto</label>
                  <input type="number" step="0.01" class="form-control" name="monto" required />
                </div>
              </div>
              <div class="mt-3">
                <button class="btn btn-warning">Recargar</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Listados -->
      <div class="tab-pane fade" id="sec-listados">
        <div class="card">
          <div class="card-body">
            <div class="section-title"><span class="dot"></span><h5 class="mb-0">Listados</h5></div>
            <div class="d-flex gap-2 mb-3">
              <button class="btn btn-outline-info" id="btn-list-usuarios">Usuarios</button>
              <button class="btn btn-outline-info" id="btn-list-vehiculos">VehÃ­culos</button>
              <button class="btn btn-outline-info" id="btn-list-registros">Registros</button>
              <button class="btn btn-outline-info" id="btn-list-recargas">Recargas</button>
            </div>
            <div id="out-list" class="table-responsive"></div>
          </div>
        </div>
      </div>

    </div> <!-- /tab-content -->

  </div> <!-- /container -->

  <!-- Toasts -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

  <!-- Modal rol -->
  <div class="modal fade" id="modalRol" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Â¿QuiÃ©n ingresa?</h5></div>
        <div class="modal-body">
          <div class="d-grid gap-2">
            <button id="btnSoyUsuario" class="btn btn-primary">Soy Usuario</button>
            <button id="btnSoyAdmin" class="btn btn-secondary">Soy Administrador</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal contraseÃ±a -->
  <div class="modal fade" id="modalPass" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">ContraseÃ±a Administrador</h5></div>
        <div class="modal-body">
          <input id="admin-pass" class="form-control" type="password" placeholder="ContraseÃ±a" />
          <div class="text-end mt-2">
            <button id="btnPassAceptar" class="btn btn-success">Entrar</button>
            <button id="btnPassCancelar" class="btn btn-secondary">Cancelar</button>
          </div>
        </div>
      </div>
    </div>
  </div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>

const apiBase = "http://127.0.0.1:5000";
const ADMIN_PASSWORD = '855910';

 // Modales
  const modalRol = new bootstrap.Modal(document.getElementById('modalRol'));
  const modalPass = new bootstrap.Modal(document.getElementById('modalPass'));

  /* ---------------------------
     On load: Rol y animaciones
     --------------------------- */
  window.addEventListener('load', () => {
    const rol = sessionStorage.getItem('rol');
    if (rol) applyRole(rol);
    else modalRol.show();

    // entrada sutil
    document.querySelectorAll('.card').forEach((c, i) => {
      c.style.animation = 'fadeInUp .45s ease both';
      c.style.animationDelay = (i * 0.06) + 's';
    });
  });

  /* ---------------------------
     Banner actions
     --------------------------- */
  document.getElementById('ad-close').addEventListener('click', () => {
    document.getElementById('ad-banner').style.display = 'none';
  });
  document.getElementById('ad-refresh').addEventListener('click', () => {
    actualizarEstado(); showToast('Actualizado','Estado refrescado manualmente','primary');
  });

  /* ---------------------------
     SelecciÃ³n de rol y contraseÃ±a
     --------------------------- */
  document.getElementById('btnSoyUsuario').addEventListener('click', () => {
    sessionStorage.setItem('rol','usuario');
    applyRole('usuario');
    modalRol.hide();
    showToast('Bienvenido','Has ingresado como usuario','primary');
  });

  document.getElementById('btnSoyAdmin').addEventListener('click', () => {
    modalPass.show();
  });

  document.getElementById('btnPassAceptar').addEventListener('click', () => {
    const val = document.getElementById('admin-pass').value;
    if (val === ADMIN_PASSWORD) {
      sessionStorage.setItem('rol','admin');
      applyRole('admin');
      modalPass.hide();
      modalRol.hide();
      showToast('Ã‰xito','Acceso administrativo concedido','success');
    } else {
      showToast('Error','ContraseÃ±a incorrecta','danger');
    }
  });

  document.getElementById('btnPassCancelar').addEventListener('click', () => {
    modalPass.hide();
  });

  document.getElementById('btn-cambiar-rol').addEventListener('click', () => {
    sessionStorage.removeItem('rol');
    const firstVisible = document.querySelector('#menu .nav-item:not([style*="display: none"]) .nav-link[data-bs-target]');
    if (firstVisible) new bootstrap.Tab(firstVisible).show();
    modalRol.show();
  });

 function applyRole(role){

  // Botones/pestaÃ±as permitidos para el usuario
  const userAllowed = ['#sec-usuario', '#sec-vehiculo'];

  document.querySelectorAll('#menu .nav-item').forEach(item => {
    const btn = item.querySelector('button[data-bs-target]');
    if (!btn) return;

    const target = btn.getAttribute('data-bs-target');

    // Si es USUARIO â†’ solo deja usuario y vehÃ­culo
    if (role === 'usuario') {
      if (userAllowed.includes(target)) {
        item.style.display = '';
      } else {
        item.style.display = 'none';
      }
    }

    // Si es ADMIN â†’ muestra todo
    if (role === 'admin') {
      item.style.display = '';
    }
  });

  // Seleccionar la primera pestaÃ±a visible
  const first = document.querySelector('#menu .nav-item:not([style*="display: none"]) .nav-link[data-bs-target]');
  if (first) new bootstrap.Tab(first).show();
}


  /* ---------------------------
     Toast helper (mejorado)
     --------------------------- */
  function showToast(title, msg, color="primary") {
    const container = document.querySelector(".toast-container");
    const el = document.createElement("div");
    el.className = `toast align-items-center text-bg-${color}`;
    el.setAttribute('role','alert');
    el.setAttribute('aria-live','assertive');
    el.innerHTML = `
      <div class="d-flex">
        <div class="toast-body"><strong style="display:block">${title}</strong>${msg}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="cerrar"></button>
      </div>`;
    container.appendChild(el);
    const toast = new bootstrap.Toast(el, { delay: 3000 });
    toast.show();
    el.addEventListener("hidden.bs.toast", () => el.remove());
  }

  /* ---------------------------
     Render tabla genÃ©rica
     --------------------------- */
  function renderTable(data) {
    if (!Array.isArray(data) || !data.length)
      return "<p class='text-muted'>No hay datos disponibles.</p>";
    const headers = Object.keys(data[0]);
    const rows = data.map(row =>
      `<tr>${headers.map(h => `<td>${row[h] ?? ''}</td>`).join("")}</tr>`
    ).join("");
    return `<table class="table table-bordered table-striped">
              <thead><tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr></thead>
              <tbody>${rows}</tbody>
            </table>`;
  }

  /* ---------------------------
     Post formulario (genÃ©rico)
     --------------------------- */
  async function postForm(formId, url, successMsg) {
    const form = document.getElementById(formId);
    const f = Object.fromEntries(new FormData(form).entries());
    try {
      const r = await fetch(apiBase + url, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(f)
      });
      const j = await r.json();
      if (r.ok) showToast("Ã‰xito", successMsg, "success");
      else showToast("Error", j.message || j.error || "Error desconocido", "danger");
    } catch (err) {
      console.error(err);
      showToast("Error", "No se pudo conectar con el servidor", "danger");
    }
  }

  // Formularios (mismos IDs que antes)
  document.getElementById("frm-usuario").addEventListener("submit", e => {
    e.preventDefault(); postForm("frm-usuario", "/usuarios", "Usuario registrado");
  });

document.getElementById("frm-vehiculo").addEventListener("submit", e => {
  e.preventDefault();
  const f = Object.fromEntries(new FormData(e.target).entries());

  const data = {
    placa: f.placa,
    tipo_vehiculo_id: parseInt(f.tipo_vehiculo_id),
    numero_identificacion: f.numero_identificacion,
    uid_rfid: f["uid.rfid"] // clave que espera tu Flask
  };

  fetch(apiBase + "/vehiculos", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  })
  .then(async r => {
    const j = await r.json();
    if (r.ok) showToast("Ã‰xito", "VehÃ­culo registrado correctamente", "success");
    else showToast("Error", j.message || j.error || "Error desconocido", "danger");
  })
  .catch(err => {
    console.error(err);
    showToast("Error", "No se pudo conectar con el servidor", "danger");
  });
});

  document.getElementById("frm-asignar").addEventListener("submit", e => {
    e.preventDefault();
    postForm("frm-asignar", "/parqueadero/asignar", "Espacio asignado correctamente");
  });

  document.getElementById("frm-salida").addEventListener("submit", e => {
    e.preventDefault();
    postForm("frm-salida", "/parqueadero/movimiento", "Salida registrada correctamente");
  });

  document.getElementById("frm-recarga").addEventListener("submit", e => {
    e.preventDefault();
    postForm("frm-recarga", "/usuarios/recargar", "Recarga realizada correctamente");
  });

  /* ---------------------------
     Listados
     --------------------------- */
  async function listar(endpoint) {
    const out = document.getElementById("out-list");
    try {
      const r = await fetch(apiBase + endpoint);
      const j = await r.json();
      out.innerHTML = renderTable(j);
    } catch (err) {
      console.error(err);
      out.innerHTML = "<p class='text-danger'>Error al cargar datos.</p>";
    }
  }

  document.getElementById("btn-list-usuarios").addEventListener("click", () => listar("/usuarios"));
  document.getElementById("btn-list-vehiculos").addEventListener("click", () => listar("/vehiculos"));
  document.getElementById("btn-list-registros").addEventListener("click", () => listar("/registros"));
  document.getElementById("btn-list-recargas").addEventListener("click", () => listar("/recargas"));

  /* ---------------------------
     Estado del parqueadero
     --------------------------- */

  // ActualizaciÃ³n automÃ¡tica del estado
async function actualizarEstado() {
  const out = document.getElementById("out-estado");
  const libresEl = document.getElementById("contador-libres");
  const ocupadosEl = document.getElementById("contador-ocupados");
  const totalEl = document.getElementById("contador-total");

  try {
    const res = await fetch(`${apiBase}/parqueadero/estado`);
    const raw = await res.json();

    let data = [];

    if (raw.estado_parqueadero) {
      for (const [id, placa] of Object.entries(raw.estado_parqueadero)) {
        data.push({
          ID: id,
          Estado: placa ? "Ocupado" : "Libre",
          Placa: placa || "-"
        });
      }
    }

    // Contadores
    const ocupados = data.filter(d => d.Estado === "Ocupado").length;
    const libres = data.filter(d => d.Estado === "Libre").length;
    const total = data.length;

    libresEl.textContent = libres;
    ocupadosEl.textContent = ocupados;
    totalEl.textContent = total;

    // No hay datos
    if (!data.length) {
      out.innerHTML = "<p class='text-muted'>No hay espacios registrados.</p>";
      return;
    }

    // Tabla
    let html = `
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-primary">
          <tr><th>ID</th><th>Estado</th><th>Placa</th></tr>
        </thead>
        <tbody>
    `;

    data.forEach(row => {
      const color = row.Estado === "Ocupado" ? "table-danger" : "table-success";

      html += `
        <tr class="${color}">
          <td>${row.ID}</td>
          <td>${row.Estado}</td>
          <td>${row.Placa}</td>
        </tr>
      `;
    });

    html += `
        </tbody>
      </table>
    `;

    out.innerHTML = html;

  } catch (err) {
    console.error(err);
    out.innerHTML = "<p class='text-danger'>Error al cargar estado.</p>";
  }
}

// Actualizar cada 5 segundos automÃ¡ticamente
setInterval(actualizarEstado, 5000);

// BotÃ³n de actualizar estado
document.getElementById("btn-estado").addEventListener("click", actualizarEstado);

// BotÃ³n para descargar Excel
document.getElementById("btn-estado-excel").addEventListener("click", () => {
  window.open(`${apiBase}/parqueadero/estado?formato=excel`, "_blank");
});


// Llamada al servidor cada segundo
// Recibe UID y lo pone en el input de registro de vehÃ­culo
function recibirUID(uid) {
  const inputRFID = document.getElementById("input-rfid");
  if (inputRFID) inputRFID.value = uid;
  // showToast("RFID detectado", `UID: ${uid}`, "success"); // opcional
}

// Actualizar RFID cada segundo
async function actualizarRFID() {
  try {
    const res = await fetch(`${apiBase}/rfid/ultimo`);
    if (!res.ok) return;
    const j = await res.json();
    if (j.uid) recibirUID(j.uid);
  } catch(err) { console.error(err); }
}

// Ejecutar solo una vez
setInterval(actualizarRFID, 1000);

setInterval(() => {
  fetch(apiBase + "/rfid/ultimo")
    .then(r => r.json())
    .then(data => {
      if (data.uid) {
        console.log("RFID recibido:", data.uid);
        const inputRFID = document.getElementById("input-rfid");
        if (inputRFID) inputRFID.value = data.uid;
      }
    })
    .catch(err => console.log("Error RFID:", err));
}, 1000);

</script>

</body>
</html>
